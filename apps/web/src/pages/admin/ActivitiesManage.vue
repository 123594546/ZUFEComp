<template><el-card><el-button type="primary" @click="open()">新增活动</el-button><el-table :data="list"><el-table-column prop="title" label="标题"/><el-table-column prop="status" label="状态"/><el-table-column><template #default="s"><el-button @click="open(s.row)">编辑</el-button><el-button type="danger" @click="remove(s.row.id)">删除</el-button></template></el-table-column></el-table></el-card><el-dialog v-model="visible" title="活动"><el-form :model="form"><el-input v-model="form.title" placeholder="标题"/><el-input v-model="form.type" placeholder="类型"/><el-input v-model="form.location" placeholder="地点"/><el-input v-model="form.description" placeholder="描述"/><el-input-number v-model="form.capacity"/><el-select v-model="form.status"><el-option value="draft"/><el-option value="published"/><el-option value="closed"/></el-select></el-form><template #footer><el-button @click="save">保存</el-button></template></el-dialog></template>
<script setup lang="ts">import { onMounted, reactive, ref } from 'vue';import { http } from '../../api/http';import { ElMessage } from 'element-plus';
const list=ref<any[]>([]);const visible=ref(false);const form=reactive<any>({title:'',type:'',tags:['校级'],description:'',location:'',startTime:new Date().toISOString(),endTime:new Date().toISOString(),signupDeadline:new Date().toISOString(),capacity:100,status:'draft'});
const load=async()=>{list.value=(await http.get('/activities',{params:{pageSize:50}})).data.data;};onMounted(load);
const open=(row?:any)=>{Object.assign(form,row||{id:'',title:'',type:'',tags:['校级'],description:'',location:'',startTime:new Date().toISOString(),endTime:new Date().toISOString(),signupDeadline:new Date().toISOString(),capacity:100,status:'draft'});visible.value=true;};
const save=async()=>{if(form.id) await http.put('/activities/'+form.id,form); else await http.post('/activities',form);ElMessage.success('保存成功');visible.value=false;load();};
const remove=async(id:string)=>{await http.delete('/activities/'+id);ElMessage.success('已删除');load();};
</script>
