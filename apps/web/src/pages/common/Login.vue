<template><el-card><el-form :model="form"><el-form-item label="学号"><el-input v-model="form.studentId"/></el-form-item><el-form-item label="密码"><el-input show-password v-model="form.password"/></el-form-item><el-button :loading="loading" type="primary" @click="submit">登录</el-button><el-button @click="$router.push('/register')">注册</el-button></el-form></el-card></template>
<script setup lang="ts">import { reactive, ref } from 'vue';import { http } from '../../api/http';import { useAuthStore } from '../../stores/auth';import { ElMessage } from 'element-plus';import { useRouter } from 'vue-router';
const form=reactive({studentId:'',password:''});const loading=ref(false);const auth=useAuthStore();const router=useRouter();
const submit=async()=>{loading.value=true;try{const{data}=await http.post('/auth/login',form);auth.setAuth(data.data.token,data.data.user);router.push(data.data.user.role==='admin'?'/admin/overview':'/app/dashboard');}catch(e:any){ElMessage.error(e.response?.data?.message||'登录失败');}finally{loading.value=false;}};
</script>
